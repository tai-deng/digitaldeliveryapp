{"remainingRequest":"C:\\Users\\Public\\软件\\app\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Public\\软件\\app\\src\\components\\issue\\Progress\\Progress.vue?vue&type=style&index=1&lang=css&","dependencies":[{"path":"C:\\Users\\Public\\软件\\app\\src\\components\\issue\\Progress\\Progress.vue","mtime":1557998374720},{"path":"C:\\Users\\Public\\软件\\app\\node_modules\\css-loader\\index.js","mtime":1552270042900},{"path":"C:\\Users\\Public\\软件\\app\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1552270044128},{"path":"C:\\Users\\Public\\软件\\app\\node_modules\\postcss-loader\\src\\index.js","mtime":1552270043529},{"path":"C:\\Users\\Public\\软件\\app\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1552270042041},{"path":"C:\\Users\\Public\\软件\\app\\node_modules\\vue-loader\\lib\\index.js","mtime":1552270044128}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.container-progress .wrapper .task .van-field__label,\n.container-progress .wrapper .schedule .van-field__label {\n  max-width: 150px;\n}\n.container-progress .wrapper .van-field__right-icon .van-icon,\n.upload-file-box .van-icon {\n  font-size: 36px;\n}\n.deletePhoto.van-dialog {\n  width: 50%!important;\n  font-size: 32px;\n}\n/* Popup begin */\n.iPopup .van-picker-column {\n  font-size: 30px;\n}\n.iPopup .van-picker__cancel,\n.iPopup .van-picker__confirm,\n.iPopup .van-picker__title {\n  font-size: 30px;\n}\n.iPopup .van-picker__toolbar {\n  height: 88px;\n  line-height: 88px;\n}\n/* Popup end */\n.container-progress .van-cell .van-field__label span{\n  font-weight: 600;\n}\n",{"version":3,"sources":["Progress.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Progress.vue","sourceRoot":"src/components/issue/Progress","sourcesContent":["<!-- Progress进度认证 -->\n<template>\n  <div class=\"container-progress\">\n    <van-nav-bar title=\"进度认证\"  @click-left=\"goBack\">\n      <span class=\"el-icon-arrow-left fontsize\" slot=\"left\"></span>\n    </van-nav-bar>\n\n    <div class=\"wrapper\">\n      <van-cell-group>\n        <van-field\n          placeholder=\"请选择楼栋\"\n          label=\"楼栋：\"\n          :right-icon=\"isFast?'arrow':''\"\n          disabled\n          v-model.trim=\"floor\"\n          @click-right-icon=\"choiceFloor\"\n        />\n      </van-cell-group>\n\n      <van-cell-group class=\"task\">\n        <van-field\n          placeholder=\"作业任务\"\n          label=\"作业任务：\"\n          :right-icon=\"isFast?'arrow':''\"\n          disabled\n          v-model.trim=\"task\"\n          @click-right-icon=\"choiceTask\"\n        />\n      </van-cell-group>\n\n      <van-cell-group class=\"schedule\">\n        <van-field placeholder=\"请输入进度百分比\" label=\"任务进度：\" v-model.trim=\"schedule\"/>\n      </van-cell-group>\n\n      <van-cell-group>\n        <van-field\n          v-model.trim=\"currentDateToString\"\n          label=\"日期\"\n          right-icon=\"arrow\"\n          placeholder=\"请选择日期\"\n          disabled\n          @click-right-icon=\"choiceTime\"\n        />\n\n      </van-cell-group>\n    </div>\n\n    <van-popup v-model=\"floor_show\" position=\"bottom\" :close-on-click-overlay=\"true\" class=\"iPopup\">\n      <van-picker\n        show-toolbar\n        title=\"楼栋\"\n        :columns=\"floor_columns\"\n        @cancel=\"onFloorCancel\"\n        @confirm=\"onFloorConfirm\"\n      />\n    </van-popup>\n\n    <van-popup v-model=\"task_show\" position=\"bottom\" class=\"iPopup\">\n      <van-picker\n        show-toolbar\n        title=\"作业任务\"\n        :columns=\"task_columns\"\n        @cancel=\"onTaskCancel\"\n        @confirm=\"onTaskConfirm\"\n      />\n    </van-popup>\n    <van-popup v-model=\"time_show\" position=\"bottom\" class=\"iPopup\">\n      <van-datetime-picker\n        type=\"date\"\n        @cancel=\"onTimeCancel\"\n        @confirm=\"onTimekConfirm\"\n      />\n    </van-popup>\n    <div class=\"wrapper-upload\">\n      <div class=\"upload-title\">上传照片</div>\n      <div class=\"upload-file\" >\n        <template v-if=\"imgList1.length\">\n          <div v-for=\"(item,index) in imgList1\" :key=\"index\" class=\"upload-file-box\" @click=\"deletePoto(index)\">\n          <img :src=\"item\" />\n        </div> \n        </template>\n        <div v-if=\"imgList1.length< 2\" class=\"upload-file-box\" @click=\"selectPhoto\">\n          <van-icon name=\"plus\"/>\n        </div>  \n        <span class=\"upload-txt\">最多上传2张</span>\n      </div>\n    </div>\n\n    <van-row class=\"progress-btn\">\n      <van-col span=\"22\" offset=\"1\">\n        <van-button type=\"info\" size=\"large\" @click=\"saveConfirm()\">确认</van-button>\n      </van-col>\n    </van-row>\n\n    <van-actionsheet\n      v-model=\"phone_show\"\n    >\n    <van-uploader :after-read=\"onRead\" accept=\"image/jpeg\" capture=\"camera\" class=\"upload-file-item\">\n      <div>\n        拍摄\n      </div>\n    </van-uploader>\n    <van-uploader :after-read=\"onRead\" class=\"upload-file-item\">\n      <div>\n        从手机相册选择\n      </div>\n    </van-uploader>\n    <div class=\"upload-file-item cancel\" @click=\"uploadCancel\">\n      取消\n    </div>\n    </van-actionsheet>\n  </div>\n</template>\n\n<script type='textecmascript-6'>\nimport {GetBuilding,\nGetACSchedulePlanCbxAPP,\nAddModelAuthentication,\nGetAuthenticationInfoByTaskId,\nUploadBase64Img\n} from '@/api/api.js'\nexport default {\n  data() {\n    return {\n      data: \"Progress进度认证\",\n      dialogImageUrl: \"\",\n      dialogVisible: false,\n      floor_show: false,\n      task_show: false,\n      time_show: false,\n      phone_show: false,\n      floor_columns: [],\n      task_columns: [],\n      floor: \"\", //当前楼栋\n      task: \"\", //当前任务\n      TaskId: '',  //任务ID\n      schedule: \"\", //当前进度\n      currentDate: new Date(), //当前时间\n      projectid: localStorage.getItem('projectid'),\n      userId: parseInt(localStorage.getItem('userId')),\n      isFast: false, //是否从首页快捷跳转过来 是:true, 否：false\n      paramsData: {}, //保存路由参数对象\n      imgList1: [],\n      UploadTime: '',  //保存获取默认认证时间\n      isNew: false   //是否新增\n    };\n  },\n  created(){\n    this.getParams()\n    this.getBuildingInfo(this.projectid)\n    \n  },\n  computed: {\n    currentDateToString(){\n      if(!this.isFast&&!this.isNew){\n        return this.UploadTime.substr(0, 10)\n      } else {\n        return require('moment')(this.currentDate).format('YYYY-MM-DD')\n      }\n      \n    }\n  },\n  methods: {\n    handleRemove(file, fileList) {\n      console.log(file, fileList);\n    },\n    handlePictureCardPreview(file) {\n      this.dialogImageUrl = file.url;\n      this.dialogVisible = true;\n    },\n    /**\n     * van-popup  显示/隐藏操作\n     */\n    choiceFloor() {\n      if(!this.isFast){\n        return\n      }\n      if (!this.floor_show) {\n        this.floor_show = true;\n      } else {\n        this.floor_show = false;\n      }\n    },\n    choiceTask() {\n      if(!this.isFast){\n        return\n      }\n      if (!this.task_show) {\n        this.task_show = true;\n      } else {\n        this.task_show = false;\n      }\n    },\n    choiceTime() {\n      if(!this.time_show) {\n        this.time_show = true\n      } else {\n        this.time_show = false\n      }\n    },\n    selectPhoto(){\n      if(!this.phone_show){\n        this.phone_show = true\n      }else {\n        this.phone_show = false\n      }\n    },\n    uploadCancel(){\n      this.phone_show = false\n    },\n    // 获取参数函数\n    getParams(){\n      console.log(this.$route.query)\n      let flag = this.$route.query.TaskId?true:false\n      console.log(flag)\n      if(flag){\n        this.floor = this.$route.query.BuildingName?this.$route.query.BuildingName: ' '\n        this.task = this.$route.query.TaskName\n        this.TaskId = this.$route.query.TaskId\n        this.paramsData = this.$route.query\n        if(this.paramsData.StatesInfo === '未开始'){\n          this.isNew = true\n        } else {\n          this.AuthenticationInfoByTaskId(this.TaskId)\n        }\n      }else {\n        this.isFast = true\n      }\n    },\n    // 确认保存\n    saveConfirm(){\n      //校验\n      if(this.floor == ''){\n        this.$toast({\n          message: '请选择楼栋',\n          duration: 800\n        })\n        return\n      }\n      if(this.task == ''){\n        this.$toast({\n          message: '请选择作业任务'\n        })\n        return\n      }\n      if(this.schedule == '') {\n        this.$toast({\n          message: '任务进度不能为空'\n        })\n        return\n      }\n      this.GetAddModelAuthentication()\n    },\n    /**\n     * 选择楼栋\n     */\n    onFloorConfirm(value,index) {\n      console.log(value)\n      console.log(index)\n      // Toast(`当前值：${value}, 当前索引：${index}`);\n      // this.$toast(`当前值：${value}, 当前索引：${index}`);\n      this.floor = value.text;\n      this.floor_show = false;\n    },\n    onFloorCancel() {\n      this.floor_show = false;\n    },\n    /**\n     * 选择作业任务\n     */\n    onTaskConfirm(value) {\n      this.task = value.text;\n      this.task_show = false;\n    },\n    onTaskCancel() {\n      this.task_show = false;\n    },\n    //删除照片\n   deletePoto(index){\n     this.$dialog.confirm({\n       title: '删除确认',\n       message: '确认删除吗？',\n       className: 'deletePhoto'\n     }).then(() => {\n       // on confirm\n       this.imgList1.splice(index, 1)\n     }).catch(() =>{\n       // on cancel\n     })\n   },\n    async onRead(file) {\n      console.log(file);\n      let params = {\n        Base64Photo: file.content,\n        fileext: file.file.name\n      }\n      let res = await this.Request(UploadBase64Img(params))\n      console.log(res)\n      if(res.StatusCode === 200){\n        let url = res.Detiel[0].TokenUrL+res.Detiel[0].smallPhotoURL\n        this.imgList1.push(url)\n        this.phone_show = false\n      }else {\n        this.$message({\n          type: 'error',\n          message: res.Message,\n          center: 'true'\n        })\n      }\n    },\n    goBack(){\n        this.$router.go(-1);\n    },\n    /**\n     * 选择日期\n     */\n    onTimekConfirm(value){\n      console.log(value)\n      if(!this.isNew) {\n        this.UploadTime = require('moment')(value).format('YYYY-MM-DD')\n        this.time_show = false\n        return false\n      }\n      this.currentDate = value\n      this.time_show = false\n    },\n    onTimeCancel() {\n      this.time_show = false\n    },\n    /**\n     * api接口\n     */\n    //获取楼栋信息\n    async getBuildingInfo(projectid){\n      console.log(this.isFast)\n      if(!this.isFast){\n        return false\n      }\n      let res = await this.Request(GetBuilding({projectid}))\n      console.log(res)\n      if(res.StatusCode === 200){\n        this.floor_columns = res.Detiel\n      }else {\n        this.$message({\n          type: 'error',\n          message: res.Message,\n          center: 'true'\n        })\n      }\n    },\n    // 根据楼栋筛选认证任务下拉\n    async ACSchedulePlanCbxAPP(ProjectID, BuildingName){\n      let res = await this.Request(GetACSchedulePlanCbxAPP({ProjectID, BuildingName}))\n      console.log(res)\n      if(res.StatusCode === 200){\n        this.task_columns = res.Detiel\n      }else {\n        this.$message({\n          type: 'error',\n          message: res.Message,\n          center: 'true'\n        })\n      }\n\n    },\n      /**\n       * 认证\n       */\n      async GetAddModelAuthentication () {\n          let data = { \n          TaskId: this.TaskId,\n          Percentage: this.schedule, \n          PicturePath: '', \n          UploadTime: this.UploadTime, \n          userId: this.userId\n          }\n         if (this.imgList1.length) {\n          //  获取URL\n          //  let URL = `${this.imgList1[0].url},${this.imgList1[1]}`\n          let URL = []\n          this.imgList1.forEach((item) => {\n            // URL += `${item.url},`\n            let len = item.indexOf('U')\n            let url = item.substring(len - 1)\n            URL.push(url)\n          })\n          // URL = URL.substr(0, (URL.length - 1))\n          data.PicturePath = URL.toString()\n        }\n        let res = await this.Request(AddModelAuthentication(data))\n        if (res.StatusCode === 200) {\n          this.$toast.success({ message: res.Message, duration: 2000,className: 'my_toast_success' })\n          setTimeout(()=>{\n            this.$router.go(-1)\n          }, 2000)\n        } else {\n          this.$toast.fail({ message: res.Message, duration: 2000,className: 'my_toast_fail' })\n        }\n      },\n      /**\n       * 查询认证详情\n       */\n      async AuthenticationInfoByTaskId (id) {\n        if (!id) return this.$toast('传入数据有误')\n        let res = await this.Request(GetAuthenticationInfoByTaskId({ TaskId: id }))\n        console.log(res)\n        if (res.StatusCode === 200) {\n          let imgObj = res.Detiel[0].PicturePath\n          if (imgObj) {\n            this.imgList1 = imgObj.split(',')\n            // this.showImg = []\n            // this.imgList1.forEach(item => {\n            //   this.showImg.push({\n            //     name: '',\n            //     url: item\n            //   })\n            // })\n          } else {\n            this.imgList1 = []\n            // this.showImg = []\n          }\n          this.schedule = res.Detiel[0].Percentage\n            console.log(this.schedule)\n          this.UploadTime = res.Detiel[0].UploadTime\n          // this.dialogForm.name = res.Detiel[0].cName\n          // this.dialogForm.progress = `${parseInt(res.Detiel[0].Percentage)}`\n          // 将监听开关重置为false\n          // this.isChange = false\n        } else {\n          this.$message({ type: 'error', message: res.Message, center: 'true' })\n        }\n      },\n  },\n  watch: {\n    floor(val){\n      if(this.isFast&&val){\n        this.ACSchedulePlanCbxAPP(this.projectid, val)\n      }\n    }\n  }\n};\n</script>\n<style lang='stylus' scoped rel='stylesheet/stylus'>\n.container-progress {\n  width: 100%;\n  height: 100%;\n}\n</style>\n\n\n<style>\n.container-progress .wrapper .task .van-field__label,\n.container-progress .wrapper .schedule .van-field__label {\n  max-width: 150px;\n}\n.container-progress .wrapper .van-field__right-icon .van-icon,\n.upload-file-box .van-icon {\n  font-size: 36px;\n}\n.deletePhoto.van-dialog {\n  width: 50%!important;\n  font-size: 32px;\n}\n/* Popup begin */\n.iPopup .van-picker-column {\n  font-size: 30px;\n}\n.iPopup .van-picker__cancel,\n.iPopup .van-picker__confirm,\n.iPopup .van-picker__title {\n  font-size: 30px;\n}\n.iPopup .van-picker__toolbar {\n  height: 88px;\n  line-height: 88px;\n}\n/* Popup end */\n.container-progress .van-cell .van-field__label span{\n  font-weight: 600;\n}\n</style>\n\n<style scoped>\n.container-progress .van-nav-bar {\n  height: 88px;\n  line-height: 88px;\n}\n.container-progress .van-nav-bar__title {\n  font-size: 36px;\n}\n.container-progress .van-nav-bar__left,\n.container-progress .van-nav-bar__right {\n  font-size: 42px;\n}\n.container-progress .wrapper .van-cell {\n  font-size: 30px;\n  line-height: 88px;\n}\n.container-progress .wrapper .van-hairline--top-bottom::after {\n  left: -330px;\n  right: -330px;\n}\n.wrapper-upload {\n  padding: 20px;\n}\n.upload-txt {\n  color: #999999;\n  font-size: 26px;\n  margin-left: 10px;\n}\n.upload-title {\n  font-size: 30px;\n  font-weight: 600;\n  padding: 20px 0;\n}\n.upload-file {\n  display: -webkit-flex;\n  flex-direction: row;\n  justify-content: flex-start;\n  align-items: flex-end;\n}\n.upload-file-box {\n  margin-right: 10px;\n  width: 200px;\n  height: 200px;\n  border: 1px lightgray dashed;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.upload-file-box>img {\n  width: 200px;\n  height: 200px;\n  border: none;\n}\n\n.upload-file-item {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width:100%;\n  height: 88px;\n  font-size: 32px;\n  color: #333;\n}\n.cancel {\n  color: #666!important;\n}\n.progress-btn {\n  margin-top: 100px;\n}\n.progress-btn .van-button--large {\n  height: 88px;\n  line-height: 88px;\n  border-radius: 10px;\n}\n.progress-btn .van-button--large .van-button__text {\n  font-size: 30px;\n}\n</style>\n\n<style>\n/* 顶部表头 */\n  .container-progress .van-nav-bar .van-nav-bar__title {\n    font-size: 36px;\n    font-weight: 600;\n  }\n  .container-progress  .van-nav-bar {\n    height: 88px;\n    line-height: 88px;\n  }\n  .my_toast_success.van-toast {\n    font-size: 30px;\n  }\n  .my_toast_success.van-toast--default{\n      width: 180px;\n      padding: 30px;\n  }\n  .my_toast_success.van-toast--text {\n      padding: 40px 40px\n  }\n  .my_toast_success.van-toast--default .van-toast__icon{\n      font-size: 96px;\n  }\n</style>\n"]}]}