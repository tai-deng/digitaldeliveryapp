{"remainingRequest":"C:\\Users\\Public\\软件\\app\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Public\\软件\\app\\src\\components\\user\\addFlow.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Public\\软件\\app\\src\\components\\user\\addFlow.vue","mtime":1557998374642},{"path":"C:\\Users\\Public\\软件\\app\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1552270042041},{"path":"C:\\Users\\Public\\软件\\app\\node_modules\\babel-loader\\lib\\index.js","mtime":1552270024016},{"path":"C:\\Users\\Public\\软件\\app\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1552270042041},{"path":"C:\\Users\\Public\\软件\\app\\node_modules\\vue-loader\\lib\\index.js","mtime":1552270044128}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {\r\n  GetOrgList,\r\n  GetDeptList,\r\n  GetUserListByDept,\r\n  GetLoginUserInfo\r\n} from \"@/api/api.js\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      isSelect: false,\r\n      actions: [],\r\n      selAction: null,\r\n      // 优先级\r\n      priorityValue: null,\r\n      // 责任单位\r\n      dutyValue: null,\r\n      //责任单位ID\r\n      OrgID: null,\r\n      // 岗位/部门\r\n      departmentValue: null,\r\n      // 岗位/部门ID\r\n      departmentID: null,\r\n      // 人员\r\n      majorValue: null,\r\n      // 优先级数据\r\n      uildingData: [\r\n        { id: 1, name: \"优先级1\" },\r\n        { id: 2, name: \"优先级2\" }\r\n      ],\r\n      // 责任单位数据\r\n      dutyData: [],\r\n      // 岗位/部门数据\r\n      departmentData: [],\r\n      // 人员数据\r\n      majorData: [],\r\n      // 流程数据\r\n      flowData: [],\r\n      userID: localStorage.getItem(\"userId\"), //用户ID\r\n      userInfo: null,\r\n      ProjectID: localStorage.getItem(\"projectid\"), //项目ID\r\n      /**按进度计划是否为审核0/1 */\r\n      isAudit: {\r\n        type: String,\r\n        default: \"1\"\r\n      },\r\n      flowList: [],\r\n      editFlag: false //true 表示编辑  false 表示新增\r\n      // 添加表单对象\r\n      // filterForm: {\r\n      //   flowList: [],\r\n      //   Priority: 1,\r\n      //   OrgId: { id: \"\", text: \"\", OrgId: \"\" }, // 单位\r\n      //   DepId: { id: \"\", text: \"\", DepId: \"\" }, // 部门\r\n      //   Person: { id: \"\", text: \"\", Person: \"\" } // 人员\r\n      // }\r\n    };\r\n  },\r\n  props: { origin: null },\r\n  created() {\r\n    this.OrgList(this.ProjectID);\r\n    this.LoginUserInfo(this.userID);\r\n    this.getParams();\r\n  },\r\n  methods: {\r\n    onClickLeft() {\r\n      this.$router.back(-1);\r\n    },\r\n    // 完成\r\n    onClickRight() {\r\n      this.flowList.forEach((item, index) => {\r\n        //没有创建时间 是创建\r\n        item.ID = 1;\r\n        item.MasterID = 1;\r\n        item.Type = 1;\r\n        item.bDelFlag = true;\r\n        item.dCreateTime = require(\"moment\")().format(\"YYYY-MM-DD\");\r\n        item.dUpdateTime = require(\"moment\")().format(\"YYYY-MM-DD\");\r\n        item.iCreator = this.userInfo.Person.id;\r\n        item.iUpdator = this.userInfo.Person.id;\r\n        item.Priority = index + 1;\r\n        // item.OrgId = item.OrgId.id\r\n        // item.DepId = item.DepId.id\r\n        // item.Person = item.Person.id\r\n      });\r\n      if (this.origin) {\r\n        this.$emit(\"onDone\", this.flowList);\r\n      } else {\r\n        this.$router.push({\r\n          path: \"/sponsorSee\",\r\n          query: { done: true, flowList: this.flowList }\r\n        });\r\n      }\r\n    },\r\n    // 优先级事件\r\n    onpriority() {\r\n      this.isSelect = true;\r\n      this.actions = this.uildingData;\r\n      this.selAction = \"priorityValue\";\r\n    },\r\n    // 责任单位事件\r\n    onduty() {\r\n      this.isSelect = true;\r\n      if (this.dutyData.length) {\r\n        this.actions = this.dutyData;\r\n      } else {\r\n        this.actions = [];\r\n      }\r\n      this.selAction = \"dutyValue\";\r\n    },\r\n    // 岗位/部门事件\r\n    ondepartment() {\r\n      if (this.departmentValue === \"无数据\") {\r\n        return false;\r\n      }\r\n      this.isSelect = true;\r\n      if (this.departmentData.length) {\r\n        this.actions = this.departmentData;\r\n      } else {\r\n        // this.departmentValue = '无数据'\r\n        this.actions = [];\r\n      }\r\n      this.selAction = \"departmentValue\";\r\n    },\r\n    // 人员事件\r\n    onMajor() {\r\n      if (this.majorValue === \"无数据\") {\r\n        return false;\r\n      }\r\n      this.isSelect = true;\r\n      if (this.majorData.length) {\r\n        this.actions = this.majorData;\r\n      } else {\r\n        // this.majorValue = '无数据'\r\n        this.actions = [];\r\n      }\r\n      // this.actions = this.majorData;\r\n      this.selAction = \"majorValue\";\r\n    },\r\n    // 上拉菜单\r\n    onSelect(v) {\r\n      this.isSelect = false;\r\n      let action = this.selAction;\r\n      if (action == \"typeValue\") {\r\n        this.typeValue = v.name;\r\n      } else if (action == \"priorityValue\") {\r\n        this.priorityValue = v.name;\r\n      } else if (action == \"dutyValue\") {\r\n        this.dutyValue = v.name;\r\n      } else if (action == \"departmentValue\") {\r\n        this.departmentValue = v.name;\r\n      } else if (action == \"majorValue\") {\r\n        this.majorValue = v.name;\r\n      }\r\n    },\r\n    // 添加\r\n    onPrimary() {\r\n      console.log(\"添加\");\r\n      if (this.isAudit == 0 && this.flowList.length == 4) {\r\n        this.$message({\r\n          type: \"warning\",\r\n          message: \"该流程为4个人\",\r\n          center: \"true\"\r\n        });\r\n        return;\r\n      }\r\n      if (!this.dutyValue) {\r\n        this.$message({\r\n          type: \"warning\",\r\n          message: \"单位不能为空!\",\r\n          center: \"true\"\r\n        });\r\n        return;\r\n      } else if (!this.departmentValue) {\r\n        this.$message({\r\n          type: \"warning\",\r\n          message: \"部门不能为空!\",\r\n          center: \"true\"\r\n        });\r\n        return;\r\n      } else if (!this.majorValue) {\r\n        this.$message({\r\n          type: \"warning\",\r\n          message: \"人员不能为空!\",\r\n          center: \"true\"\r\n        });\r\n        return;\r\n      }\r\n      let OrgId = {\r\n        id: this.OrgID,\r\n        name: this.dutyValue,\r\n        OrgId: this.dutyValue\r\n      }; //责任单位\r\n      let DepId = {\r\n        id: this.departmentID,\r\n        name: this.departmentValue,\r\n        DepId: this.departmentValue\r\n      }; //岗位部门\r\n      const majorId = this.searchID(this.majorData, this.majorValue);\r\n      let Person = {\r\n        id: majorId,\r\n        name: this.majorValue,\r\n        Person: this.majorValue\r\n      };\r\n      let priority = this.searchID(this.uildingData, this.priorityValue);\r\n      let item = {\r\n        Priority: 0, //优先级\r\n        OrgId, //责任单位\r\n        DepId, //岗位部门\r\n        Person, //人员\r\n        Status: 0\r\n      };\r\n      console.log(priority);\r\n      if (priority === 1) {\r\n        //  priority -= 1\r\n        let num = -1;\r\n        this.flowList.forEach((it, index) => {\r\n          let per = JSON.stringify(it.Person);\r\n          let p = JSON.stringify(item.Person);\r\n          if (p === per) {\r\n            num = index;\r\n          }\r\n        });\r\n        console.log(num);\r\n        if (num != -1) {\r\n          this.flowList.splice(num, 1);\r\n          this.uildingData.pop(this.uildingData.length - 1);\r\n        }\r\n        this.flowList.splice(priority, 0, item);\r\n      } else {\r\n        let num = -1;\r\n        this.flowList.forEach((it, index) => {\r\n          let per = JSON.stringify(it.Person);\r\n          let p = JSON.stringify(item.Person);\r\n          if (p === per) {\r\n            num = index;\r\n          }\r\n        });\r\n        console.log(num);\r\n        if (num != -1) {\r\n          this.flowList.splice(num, 1);\r\n          this.uildingData.pop(this.uildingData.length - 1);\r\n        }\r\n        this.flowList.splice(priority - 1, 0, item);\r\n      }\r\n\r\n      // this.flowList.forEach((item,index)=>{\r\n      //   item.Priority = index+1\r\n      // })\r\n      let id = this.flowList.length + 1;\r\n\r\n      this.uildingData.push({\r\n        id,\r\n        name: `优先级${id}`\r\n      });\r\n      console.log(this.flowList);\r\n    },\r\n    // 删除\r\n    onDelete(i) {\r\n      console.log(i);\r\n      if (i) {\r\n        this.flowList.splice(i, 1);\r\n        this.uildingData.pop(this.uildingData.length - 1);\r\n      }\r\n      // this.flowList.forEach((item,index)=>{\r\n      //   item.Priority = index+1\r\n      // })\r\n    },\r\n    //查询对应ID函数\r\n    searchID(dataList, val) {\r\n      let id = null;\r\n      if (dataList.length) {\r\n        dataList.forEach(item => {\r\n          if (item.name === val) {\r\n            id = item.ID || item.id;\r\n          }\r\n        });\r\n      }\r\n      return id;\r\n    },\r\n    //获取路由的参数\r\n    getParams() {\r\n      let flowList = this.$route.query.flowList;\r\n      console.log(flowList);\r\n      if (flowList) {\r\n        // 编辑进入\r\n        this.flowList = flowList;\r\n        this.editFlag = true;\r\n        this.uildingData = []\r\n        for(let i = 0; i<=this.flowList.length; i++){\r\n          let uildIts = {\r\n            id: i+1,\r\n            name: `优先级${i+1}`\r\n          }\r\n          this.uildingData.push(uildIts)\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * api接口\r\n     */\r\n    // 获取单位列表 type为单位类型(1:建设单位,2:勘察单位,3:设计单位,4:监理单位,5:施工单位,6:其他单位)\r\n    async OrgList(ProjectID) {\r\n      let res = await this.Request(GetOrgList({ projectId: ProjectID }));\r\n      console.log(res);\r\n      if (res.StatusCode === 200) {\r\n        let dataArr = res.Detiel;\r\n        this.dutyData = JSON.parse(\r\n          JSON.stringify(dataArr).replace(/Name/g, \"name\")\r\n        );\r\n        if (this.dutyData.length === 0) {\r\n          this.dutyValue = \"无数据\";\r\n          this.departmentValue = \"无数据\";\r\n          this.majorValue = \"无数据\";\r\n        } else {\r\n          this.dutyValue = null;\r\n        }\r\n        console.log(this.dutyData);\r\n      } else {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: res.Message,\r\n          center: \"true\"\r\n        });\r\n      }\r\n    },\r\n    // 按公司获取部门数据列表\r\n    async DeptList(orgId) {\r\n      let res = await this.Request(GetDeptList({ orgId }));\r\n      console.log(res);\r\n      if (res.StatusCode === 200) {\r\n        let dataArr = res.Detiel;\r\n        this.departmentData = JSON.parse(\r\n          JSON.stringify(dataArr).replace(/text/g, \"name\")\r\n        );\r\n        console.log(this.departmentData);\r\n        if (this.departmentData.length === 0) {\r\n          this.departmentValue = \"无数据\";\r\n          this.majorValue = \"无数据\";\r\n        } else {\r\n          this.departmentValue = null;\r\n        }\r\n      } else {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: res.Message,\r\n          center: \"true\"\r\n        });\r\n      }\r\n    },\r\n    // 根据项目ID和单位ID以及部门ID获取人员列表\r\n    async UserListByDept() {\r\n      let data = {\r\n        projectId: this.ProjectID,\r\n        orgId: this.OrgID,\r\n        deptId: this.departmentID\r\n      };\r\n      let res = await this.Request(GetUserListByDept(data));\r\n      console.log(res);\r\n      if (res.StatusCode === 200) {\r\n        let dataArr = res.Detiel;\r\n        this.majorData = JSON.parse(\r\n          JSON.stringify(dataArr).replace(/text/g, \"name\")\r\n        );\r\n        console.log(this.majorData);\r\n        if (this.majorData.length === 0) {\r\n          this.majorValue = \"无数据\";\r\n        } else {\r\n          this.majorValue = null;\r\n        }\r\n      } else {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: res.Message,\r\n          center: \"true\"\r\n        });\r\n      }\r\n    },\r\n    // 获取当前登录用户详情接口\r\n    async LoginUserInfo(userID) {\r\n      let res = await this.Request(GetLoginUserInfo({ curUserId: userID }));\r\n      console.log(res);\r\n      if (res.StatusCode === 200) {\r\n        let item = res.Detiel[0].loginUserInfo;\r\n        this.userInfo = {\r\n          OrgId: { name: item.WeChatNo, id: item.iSys_Company_ID },\r\n          DepId: { name: item.cDepName, id: item.iSys_Dep_ID },\r\n          Person: { name: item.cName, id: item.ID },\r\n          Status: 4\r\n        };\r\n        if (this.editFlag) {\r\n          return false;\r\n        } else {\r\n          this.flowList.push(this.userInfo);\r\n          console.log(this.flowList);\r\n        }\r\n\r\n        // let dataArr = res.Detiel\r\n        // this.majorData= JSON.parse(JSON.stringify(dataArr).replace(/text/g,'name'))\r\n        // console.log(this.majorData)\r\n      } else {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: res.Message,\r\n          center: \"true\"\r\n        });\r\n      }\r\n    }\r\n  },\r\n  watch: {\r\n    dutyValue(val) {\r\n      if(val === '无数据'|| val === null){\r\n        return false\r\n      }\r\n      //根据选择责任单位获取部门列表数据\r\n      this.OrgID = this.searchID(this.dutyData, val);\r\n      this.DeptList(this.OrgID);\r\n    },\r\n    departmentValue(val) {\r\n      console.log(val);\r\n      if(val === '无数据'|| val === null){\r\n        return false\r\n      }\r\n      // 根据项目ID和单位ID以及部门ID获取人员列表\r\n      this.departmentID = this.searchID(this.departmentData, val);\r\n      console.log(this.departmentID);\r\n      this.UserListByDept();\r\n    }\r\n  }\r\n};\r\n",{"version":3,"sources":["addFlow.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"addFlow.vue","sourceRoot":"src/components/user","sourcesContent":["<!-- 编辑工作流程 addFlow -->\r\n<template>\r\n  <div class=\"container-addFlow\">\r\n    <van-nav-bar\r\n      title=\"编辑工作流程\"\r\n      left-arrow\r\n      border\r\n      @click-left=\"onClickLeft\"\r\n      @click-right=\"onClickRight\"\r\n    >\r\n      <div class=\"projectBnt\" slot=\"right\">完成</div>\r\n    </van-nav-bar>\r\n    <div class=\"content\">\r\n      <div class=\"project-content\">\r\n        <div class=\"addFlow-type flex-between item-s\" @click=\"onpriority\">\r\n          <div class=\"addFlow-type-l flex\">\r\n            <div class=\"addFlow-type-l-name text-font-have\">优先级：</div>\r\n            <div\r\n              class=\"addFlow-type-l-v\"\r\n              :class=\"[priorityValue?'text-font-have':'text-font-none']\"\r\n            >{{priorityValue?priorityValue:'请选择优先级'}}</div>\r\n          </div>\r\n          <div class=\"addFlow-type-arrow\">\r\n            <img src=\"./user_assets/imgs/arrow-right.png\">\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"addFlow-type flex-between item-s\" @click=\"onduty\">\r\n          <div class=\"addFlow-type-l flex\">\r\n            <div class=\"addFlow-type-l-name text-font-have\">责任单位：</div>\r\n            <div\r\n              class=\"addFlow-type-l-v\"\r\n              :class=\"[dutyValue?'text-font-have':'text-font-none']\"\r\n            >{{dutyValue?dutyValue:'请选择责任单位'}}</div>\r\n          </div>\r\n          <div class=\"addFlow-type-arrow\">\r\n            <img src=\"./user_assets/imgs/arrow-right.png\">\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"addFlow-type flex-between item-s\" @click=\"ondepartment\">\r\n          <div class=\"addFlow-type-l flex\">\r\n            <div class=\"addFlow-type-l-name text-font-have\">岗位/部门：</div>\r\n            <div\r\n              class=\"addFlow-type-l-v\"\r\n              :class=\"[departmentValue?'text-font-have':'text-font-none']\"\r\n            >{{departmentValue?departmentValue:'请选择岗位/部门'}}</div>\r\n          </div>\r\n          <div class=\"addFlow-type-arrow\">\r\n            <img src=\"./user_assets/imgs/arrow-right.png\">\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"addFlow-type flex-between item-s\" @click=\"onMajor\">\r\n          <div class=\"addFlow-type-l flex\">\r\n            <div class=\"addFlow-type-l-name text-font-have\">人员：</div>\r\n            <div\r\n              class=\"addFlow-type-l-v\"\r\n              :class=\"[majorValue?'text-font-have':'text-font-none']\"\r\n            >{{majorValue?majorValue:'请选择人员'}}</div>\r\n          </div>\r\n          <div class=\"addFlow-type-arrow\">\r\n            <img src=\"./user_assets/imgs/arrow-right.png\">\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"btn-warp\">\r\n        <van-button class=\"btn\" square type=\"primary\" block @click=\"onPrimary\">添加流程</van-button>\r\n      </div>\r\n\r\n      <div class=\"flow-content\">\r\n        <div class=\"flow-content-item flex\" v-for=\"(item,index) in flowList\" :key=\"index\">\r\n          <div class=\"flow-content-item-l flex-row\">\r\n            {{index+1}}\r\n            <div class=\"line\" v-if=\"index !== flowList.length-1\"></div>\r\n          </div>\r\n\r\n          <div class=\"flow-content-item-c flex\">\r\n            <div\r\n              class=\"flow-content-item-c-l flex-row flow-content-item-border\"\r\n            >{{item.Person.name}}</div>\r\n            <div class=\"flow-content-item-c-l flex-row flow-content-item-border\">{{item.OrgId.name}}</div>\r\n            <div class=\"flow-content-item-c-l flex-row\">{{item.DepId.name}}</div>\r\n            <div class=\"flow-content-item-c-triangle\">\r\n              <div class=\"flow-content-item-c-triangle-b\"></div>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"flow-content-item-r\" @click=\"onDelete(index)\">\r\n            <img src=\"./user_assets/imgs/delete.png\">\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <van-actionsheet v-model=\"isSelect\" :actions=\"actions\" @select=\"onSelect\"/>\r\n  </div>\r\n</template>\r\n\r\n<script type='textecmascript-6'>\r\nimport {\r\n  GetOrgList,\r\n  GetDeptList,\r\n  GetUserListByDept,\r\n  GetLoginUserInfo\r\n} from \"@/api/api.js\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      isSelect: false,\r\n      actions: [],\r\n      selAction: null,\r\n      // 优先级\r\n      priorityValue: null,\r\n      // 责任单位\r\n      dutyValue: null,\r\n      //责任单位ID\r\n      OrgID: null,\r\n      // 岗位/部门\r\n      departmentValue: null,\r\n      // 岗位/部门ID\r\n      departmentID: null,\r\n      // 人员\r\n      majorValue: null,\r\n      // 优先级数据\r\n      uildingData: [\r\n        { id: 1, name: \"优先级1\" },\r\n        { id: 2, name: \"优先级2\" }\r\n      ],\r\n      // 责任单位数据\r\n      dutyData: [],\r\n      // 岗位/部门数据\r\n      departmentData: [],\r\n      // 人员数据\r\n      majorData: [],\r\n      // 流程数据\r\n      flowData: [],\r\n      userID: localStorage.getItem(\"userId\"), //用户ID\r\n      userInfo: null,\r\n      ProjectID: localStorage.getItem(\"projectid\"), //项目ID\r\n      /**按进度计划是否为审核0/1 */\r\n      isAudit: {\r\n        type: String,\r\n        default: \"1\"\r\n      },\r\n      flowList: [],\r\n      editFlag: false //true 表示编辑  false 表示新增\r\n      // 添加表单对象\r\n      // filterForm: {\r\n      //   flowList: [],\r\n      //   Priority: 1,\r\n      //   OrgId: { id: \"\", text: \"\", OrgId: \"\" }, // 单位\r\n      //   DepId: { id: \"\", text: \"\", DepId: \"\" }, // 部门\r\n      //   Person: { id: \"\", text: \"\", Person: \"\" } // 人员\r\n      // }\r\n    };\r\n  },\r\n  props: { origin: null },\r\n  created() {\r\n    this.OrgList(this.ProjectID);\r\n    this.LoginUserInfo(this.userID);\r\n    this.getParams();\r\n  },\r\n  methods: {\r\n    onClickLeft() {\r\n      this.$router.back(-1);\r\n    },\r\n    // 完成\r\n    onClickRight() {\r\n      this.flowList.forEach((item, index) => {\r\n        //没有创建时间 是创建\r\n        item.ID = 1;\r\n        item.MasterID = 1;\r\n        item.Type = 1;\r\n        item.bDelFlag = true;\r\n        item.dCreateTime = require(\"moment\")().format(\"YYYY-MM-DD\");\r\n        item.dUpdateTime = require(\"moment\")().format(\"YYYY-MM-DD\");\r\n        item.iCreator = this.userInfo.Person.id;\r\n        item.iUpdator = this.userInfo.Person.id;\r\n        item.Priority = index + 1;\r\n        // item.OrgId = item.OrgId.id\r\n        // item.DepId = item.DepId.id\r\n        // item.Person = item.Person.id\r\n      });\r\n      if (this.origin) {\r\n        this.$emit(\"onDone\", this.flowList);\r\n      } else {\r\n        this.$router.push({\r\n          path: \"/sponsorSee\",\r\n          query: { done: true, flowList: this.flowList }\r\n        });\r\n      }\r\n    },\r\n    // 优先级事件\r\n    onpriority() {\r\n      this.isSelect = true;\r\n      this.actions = this.uildingData;\r\n      this.selAction = \"priorityValue\";\r\n    },\r\n    // 责任单位事件\r\n    onduty() {\r\n      this.isSelect = true;\r\n      if (this.dutyData.length) {\r\n        this.actions = this.dutyData;\r\n      } else {\r\n        this.actions = [];\r\n      }\r\n      this.selAction = \"dutyValue\";\r\n    },\r\n    // 岗位/部门事件\r\n    ondepartment() {\r\n      if (this.departmentValue === \"无数据\") {\r\n        return false;\r\n      }\r\n      this.isSelect = true;\r\n      if (this.departmentData.length) {\r\n        this.actions = this.departmentData;\r\n      } else {\r\n        // this.departmentValue = '无数据'\r\n        this.actions = [];\r\n      }\r\n      this.selAction = \"departmentValue\";\r\n    },\r\n    // 人员事件\r\n    onMajor() {\r\n      if (this.majorValue === \"无数据\") {\r\n        return false;\r\n      }\r\n      this.isSelect = true;\r\n      if (this.majorData.length) {\r\n        this.actions = this.majorData;\r\n      } else {\r\n        // this.majorValue = '无数据'\r\n        this.actions = [];\r\n      }\r\n      // this.actions = this.majorData;\r\n      this.selAction = \"majorValue\";\r\n    },\r\n    // 上拉菜单\r\n    onSelect(v) {\r\n      this.isSelect = false;\r\n      let action = this.selAction;\r\n      if (action == \"typeValue\") {\r\n        this.typeValue = v.name;\r\n      } else if (action == \"priorityValue\") {\r\n        this.priorityValue = v.name;\r\n      } else if (action == \"dutyValue\") {\r\n        this.dutyValue = v.name;\r\n      } else if (action == \"departmentValue\") {\r\n        this.departmentValue = v.name;\r\n      } else if (action == \"majorValue\") {\r\n        this.majorValue = v.name;\r\n      }\r\n    },\r\n    // 添加\r\n    onPrimary() {\r\n      console.log(\"添加\");\r\n      if (this.isAudit == 0 && this.flowList.length == 4) {\r\n        this.$message({\r\n          type: \"warning\",\r\n          message: \"该流程为4个人\",\r\n          center: \"true\"\r\n        });\r\n        return;\r\n      }\r\n      if (!this.dutyValue) {\r\n        this.$message({\r\n          type: \"warning\",\r\n          message: \"单位不能为空!\",\r\n          center: \"true\"\r\n        });\r\n        return;\r\n      } else if (!this.departmentValue) {\r\n        this.$message({\r\n          type: \"warning\",\r\n          message: \"部门不能为空!\",\r\n          center: \"true\"\r\n        });\r\n        return;\r\n      } else if (!this.majorValue) {\r\n        this.$message({\r\n          type: \"warning\",\r\n          message: \"人员不能为空!\",\r\n          center: \"true\"\r\n        });\r\n        return;\r\n      }\r\n      let OrgId = {\r\n        id: this.OrgID,\r\n        name: this.dutyValue,\r\n        OrgId: this.dutyValue\r\n      }; //责任单位\r\n      let DepId = {\r\n        id: this.departmentID,\r\n        name: this.departmentValue,\r\n        DepId: this.departmentValue\r\n      }; //岗位部门\r\n      const majorId = this.searchID(this.majorData, this.majorValue);\r\n      let Person = {\r\n        id: majorId,\r\n        name: this.majorValue,\r\n        Person: this.majorValue\r\n      };\r\n      let priority = this.searchID(this.uildingData, this.priorityValue);\r\n      let item = {\r\n        Priority: 0, //优先级\r\n        OrgId, //责任单位\r\n        DepId, //岗位部门\r\n        Person, //人员\r\n        Status: 0\r\n      };\r\n      console.log(priority);\r\n      if (priority === 1) {\r\n        //  priority -= 1\r\n        let num = -1;\r\n        this.flowList.forEach((it, index) => {\r\n          let per = JSON.stringify(it.Person);\r\n          let p = JSON.stringify(item.Person);\r\n          if (p === per) {\r\n            num = index;\r\n          }\r\n        });\r\n        console.log(num);\r\n        if (num != -1) {\r\n          this.flowList.splice(num, 1);\r\n          this.uildingData.pop(this.uildingData.length - 1);\r\n        }\r\n        this.flowList.splice(priority, 0, item);\r\n      } else {\r\n        let num = -1;\r\n        this.flowList.forEach((it, index) => {\r\n          let per = JSON.stringify(it.Person);\r\n          let p = JSON.stringify(item.Person);\r\n          if (p === per) {\r\n            num = index;\r\n          }\r\n        });\r\n        console.log(num);\r\n        if (num != -1) {\r\n          this.flowList.splice(num, 1);\r\n          this.uildingData.pop(this.uildingData.length - 1);\r\n        }\r\n        this.flowList.splice(priority - 1, 0, item);\r\n      }\r\n\r\n      // this.flowList.forEach((item,index)=>{\r\n      //   item.Priority = index+1\r\n      // })\r\n      let id = this.flowList.length + 1;\r\n\r\n      this.uildingData.push({\r\n        id,\r\n        name: `优先级${id}`\r\n      });\r\n      console.log(this.flowList);\r\n    },\r\n    // 删除\r\n    onDelete(i) {\r\n      console.log(i);\r\n      if (i) {\r\n        this.flowList.splice(i, 1);\r\n        this.uildingData.pop(this.uildingData.length - 1);\r\n      }\r\n      // this.flowList.forEach((item,index)=>{\r\n      //   item.Priority = index+1\r\n      // })\r\n    },\r\n    //查询对应ID函数\r\n    searchID(dataList, val) {\r\n      let id = null;\r\n      if (dataList.length) {\r\n        dataList.forEach(item => {\r\n          if (item.name === val) {\r\n            id = item.ID || item.id;\r\n          }\r\n        });\r\n      }\r\n      return id;\r\n    },\r\n    //获取路由的参数\r\n    getParams() {\r\n      let flowList = this.$route.query.flowList;\r\n      console.log(flowList);\r\n      if (flowList) {\r\n        // 编辑进入\r\n        this.flowList = flowList;\r\n        this.editFlag = true;\r\n        this.uildingData = []\r\n        for(let i = 0; i<=this.flowList.length; i++){\r\n          let uildIts = {\r\n            id: i+1,\r\n            name: `优先级${i+1}`\r\n          }\r\n          this.uildingData.push(uildIts)\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * api接口\r\n     */\r\n    // 获取单位列表 type为单位类型(1:建设单位,2:勘察单位,3:设计单位,4:监理单位,5:施工单位,6:其他单位)\r\n    async OrgList(ProjectID) {\r\n      let res = await this.Request(GetOrgList({ projectId: ProjectID }));\r\n      console.log(res);\r\n      if (res.StatusCode === 200) {\r\n        let dataArr = res.Detiel;\r\n        this.dutyData = JSON.parse(\r\n          JSON.stringify(dataArr).replace(/Name/g, \"name\")\r\n        );\r\n        if (this.dutyData.length === 0) {\r\n          this.dutyValue = \"无数据\";\r\n          this.departmentValue = \"无数据\";\r\n          this.majorValue = \"无数据\";\r\n        } else {\r\n          this.dutyValue = null;\r\n        }\r\n        console.log(this.dutyData);\r\n      } else {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: res.Message,\r\n          center: \"true\"\r\n        });\r\n      }\r\n    },\r\n    // 按公司获取部门数据列表\r\n    async DeptList(orgId) {\r\n      let res = await this.Request(GetDeptList({ orgId }));\r\n      console.log(res);\r\n      if (res.StatusCode === 200) {\r\n        let dataArr = res.Detiel;\r\n        this.departmentData = JSON.parse(\r\n          JSON.stringify(dataArr).replace(/text/g, \"name\")\r\n        );\r\n        console.log(this.departmentData);\r\n        if (this.departmentData.length === 0) {\r\n          this.departmentValue = \"无数据\";\r\n          this.majorValue = \"无数据\";\r\n        } else {\r\n          this.departmentValue = null;\r\n        }\r\n      } else {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: res.Message,\r\n          center: \"true\"\r\n        });\r\n      }\r\n    },\r\n    // 根据项目ID和单位ID以及部门ID获取人员列表\r\n    async UserListByDept() {\r\n      let data = {\r\n        projectId: this.ProjectID,\r\n        orgId: this.OrgID,\r\n        deptId: this.departmentID\r\n      };\r\n      let res = await this.Request(GetUserListByDept(data));\r\n      console.log(res);\r\n      if (res.StatusCode === 200) {\r\n        let dataArr = res.Detiel;\r\n        this.majorData = JSON.parse(\r\n          JSON.stringify(dataArr).replace(/text/g, \"name\")\r\n        );\r\n        console.log(this.majorData);\r\n        if (this.majorData.length === 0) {\r\n          this.majorValue = \"无数据\";\r\n        } else {\r\n          this.majorValue = null;\r\n        }\r\n      } else {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: res.Message,\r\n          center: \"true\"\r\n        });\r\n      }\r\n    },\r\n    // 获取当前登录用户详情接口\r\n    async LoginUserInfo(userID) {\r\n      let res = await this.Request(GetLoginUserInfo({ curUserId: userID }));\r\n      console.log(res);\r\n      if (res.StatusCode === 200) {\r\n        let item = res.Detiel[0].loginUserInfo;\r\n        this.userInfo = {\r\n          OrgId: { name: item.WeChatNo, id: item.iSys_Company_ID },\r\n          DepId: { name: item.cDepName, id: item.iSys_Dep_ID },\r\n          Person: { name: item.cName, id: item.ID },\r\n          Status: 4\r\n        };\r\n        if (this.editFlag) {\r\n          return false;\r\n        } else {\r\n          this.flowList.push(this.userInfo);\r\n          console.log(this.flowList);\r\n        }\r\n\r\n        // let dataArr = res.Detiel\r\n        // this.majorData= JSON.parse(JSON.stringify(dataArr).replace(/text/g,'name'))\r\n        // console.log(this.majorData)\r\n      } else {\r\n        this.$message({\r\n          type: \"error\",\r\n          message: res.Message,\r\n          center: \"true\"\r\n        });\r\n      }\r\n    }\r\n  },\r\n  watch: {\r\n    dutyValue(val) {\r\n      if(val === '无数据'|| val === null){\r\n        return false\r\n      }\r\n      //根据选择责任单位获取部门列表数据\r\n      this.OrgID = this.searchID(this.dutyData, val);\r\n      this.DeptList(this.OrgID);\r\n    },\r\n    departmentValue(val) {\r\n      console.log(val);\r\n      if(val === '无数据'|| val === null){\r\n        return false\r\n      }\r\n      // 根据项目ID和单位ID以及部门ID获取人员列表\r\n      this.departmentID = this.searchID(this.departmentData, val);\r\n      console.log(this.departmentID);\r\n      this.UserListByDept();\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style lang='stylus' scoped rel='stylesheet/stylus'>\r\n@import './user_assets/base.css';\r\n\r\n.container-addFlow {\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(246, 248, 250, 1);\r\n\r\n  .projectBnt {\r\n    height: 1.18rem;\r\n    line-height: 1.18rem;\r\n    font-size: 26px;\r\n    font-family: SourceHanSansCN-Regular;\r\n    font-weight: 400;\r\n    color: rgba(90, 146, 255, 1);\r\n  }\r\n\r\n  .btn-warp {\r\n    padding: 0.4rem 0.32rem;\r\n    background: rgba(246, 248, 250, 1);\r\n    border-bottom: 0.03rem solid #E5E5E5;\r\n  }\r\n\r\n  .content {\r\n    width: 100%;\r\n    height: calc(100% - 88px)\r\n    overflow-y: auto;\r\n    .flow-content {\r\n      padding: 0 0.32rem;\r\n\r\n      .flow-content-item {\r\n        margin-top: 0.4rem;\r\n\r\n        .flow-content-item-l {\r\n          width: 0.53rem;\r\n          height: 0.53rem;\r\n          border-radius: 50%;\r\n          background: rgba(59, 72, 95, 1);\r\n          font-size: 30px;\r\n          font-family: SourceHanSansCN-Medium;\r\n          font-weight: 500;\r\n          color: rgba(255, 255, 255, 1);\r\n          position: relative;\r\n          margin-right: 0.55rem;\r\n\r\n          .line {\r\n            position: absolute;\r\n            top: 0.64rem;\r\n            left: 0.23rem;\r\n            width: 0.05rem;\r\n            height: 0.83rem;\r\n            background-color: #979797;\r\n          }\r\n        }\r\n\r\n        .flow-content-item-c {\r\n          flex: 1;\r\n          font-size: 30px;\r\n          font-family: SourceHanSansCN-Medium;\r\n          font-weight: 500;\r\n          color: rgba(51, 51, 51, 1);\r\n          background: rgba(255, 255, 255, 1);\r\n          box-shadow: 0px 1px 4px 0px rgba(220, 226, 237, 1);\r\n          border-radius: 0.03;\r\n          height: 1.18rem;\r\n          position: relative;\r\n\r\n          .flow-content-item-c-triangle {\r\n            top: 0;\r\n            left: -0.3rem;\r\n            position: absolute;\r\n            height: 1.18rem;\r\n            width: 0.3rem;\r\n            overflow: hidden;\r\n\r\n            .flow-content-item-c-triangle-b {\r\n              position: absolute;\r\n              transform: rotate(45deg) !important;\r\n              -ms-transform: rotate(45deg) !important;\r\n              -moz-transform: rotate(45deg) !important;\r\n              -webkit-transform: rotate(45deg) !important;\r\n              -o-transform: rotate(45deg) !important;\r\n              background: rgba(255, 255, 255, 1);\r\n              box-shadow: 0px 1px 4px 0px rgba(220, 226, 237, 1);\r\n              height: 0.4rem;\r\n              width: 0.4rem;\r\n              top: 0.39rem;\r\n              left: 0.15rem;\r\n            }\r\n          }\r\n\r\n          .flow-content-item-c-l {\r\n            flex: 1;\r\n          }\r\n\r\n          .flow-content-item-border {\r\n            border-right: 0.03rem dashed #979797;\r\n          }\r\n        }\r\n\r\n        .flow-content-item-r {\r\n          margin-left: 0.56rem;\r\n\r\n          img {\r\n            width: 0.46rem;\r\n            height: 0.46rem;\r\n            display: block;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    .addFlow-type-arrow img {\r\n      width: 0.24rem;\r\n      height: 0.43;\r\n      display: block;\r\n    }\r\n\r\n    .van-button--primary {\r\n      height: 1.18rem;\r\n      background: rgba(90, 147, 255, 1);\r\n      border-radius: 0.15rem;\r\n      font-size: 30px;\r\n      font-family: SourceHanSansCN-Medium;\r\n      font-weight: 500;\r\n      color: rgba(255, 255, 255, 1);\r\n    }\r\n\r\n    .item-s {\r\n      height: 1.18rem;\r\n      line-height: 1.18rem;\r\n      font-size: 30px;\r\n      font-family: SourceHanSansCN-Regular;\r\n      font-weight: 400;\r\n      color: rgba(51, 51, 51, 1);\r\n      border-bottom: 0.017rem solid #E5E5E5;\r\n      margin: 0 0.32rem;\r\n    }\r\n\r\n    .project-content {\r\n      background-color: #fff;\r\n    }\r\n  }\r\n\r\n  .text-font-have {\r\n    font-size: 30px;\r\n    font-family: SourceHanSansCN-Regular;\r\n    font-weight: 400;\r\n    color: rgba(51, 51, 51, 1);\r\n  }\r\n\r\n  .text-font-none {\r\n    font-size: 30px;\r\n    font-family: SourceHanSansCN-Regular;\r\n    font-weight: 400;\r\n    color: rgba(153, 153, 153, 1);\r\n  }\r\n\r\n  .van-popup .van-actionsheet__item {\r\n    height: 1.18rem !important;\r\n    line-height: 1.18rem !important;\r\n    font-size: 30px;\r\n  }\r\n  .addFlow-type-l {\r\n    width: 100%;\r\n  }\r\n  .addFlow-type-l-v {\r\n    \r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    white-space: nowrap;\r\n  }\r\n  .addFlow-type-l-name {\r\n    width: 170px;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    white-space: nowrap;\r\n  }\r\n}\r\n</style>\r\n"]}]}